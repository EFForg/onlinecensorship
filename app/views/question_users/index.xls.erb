<table width="100%" cellspacing="2" border="1">
  <tr>
    <th style="text-align:left; font-weight:bold;">Registered at</th>
    <th style="text-align:left; font-weight:bold;">Age</th>
    <th style="text-align:left; font-weight:bold;">Platform</th>
    <% @questions.each do |question| %>
      <th style="text-align:left; font-weight:bold;"><%=question.question_title.gsub('{platform}',@platform.title)%></th>
    <% end %>
    <th style="text-align:left; font-weight:bold;">May we contact you to follow up on this report? </th>
    <th style="text-align:left; font-weight:bold;">Please provide us your email address so we may follow up with you. If you use encrypted mail, please provide us your public key so that we may communicate securely. If there is another means of communication that you prefer, please specify and provide contact details. </th>
    <th style="text-align:left; font-weight:bold;">Would you like us to contact the platform about your case? We cannot guarantee a response. </th>
  </tr>

  <% @question_users.each do |user| %>
    <tr>
      <td><%= user.created_at.to_date %></td>
      <td><%= user.age %></td>
      <td><%= @platform.title %></td>
      <% @questions.each do |question| %>
        <td>
          <%
          # platform_id = @platform.id
          # question_id = question.id
          # question_user_id = user.id

          # get the question_page_id
          question_page(question.id,@platform.id)

          # get the question_user_submission_id
          question_user_submission(user.id,@question_page_id)

          # binding.pry

          # get the answer
          if @question_user_submission.present? && question.present?
            question_answer(question.id,@question_user_submission.id)
            question_type=question.question_type
          end
          # show the question answer according to the type
          %>
          <% if question_type=="text" || question_type=="long_text" || question_type=="url" || question_type=="email" %>
            <% if @answer != nil && @answer.answer_text.present?  %>
              <%=@answer.answer_text%>
            <% end %>
          <% elsif question_type=="upload" %>
            <%= file_download_link(@question_user_submission) %>
          <% elsif question_type=="select" %>
            <% if @answer != nil && @answer.question_option.present?%>
              <%=@answer.question_option.option_title.gsub('{platform}',@platform.title)%>
            <% end %>
          <% elsif question_type=="multi_select" %>
            <% showMultiOptionsAnswers(@answer.question_id,@question_user_submission.id) %>
            <% if @question_answers.count >0 %>
              <% @question_answers.each do |option| %>
                <ul>
                  <% if option.other_option_answer %>
                    <li><%=option.other_option_answer%></li>
                  <% else %>
                    <li><%=option.question_option.option_title.gsub('{platform}',@platform.title)%></li>
                  <% end %>
                </ul>
              <% end %>
            <% else %>
              no answer
            <% end %>
          <% elsif question_type=="countries" %>
            <% if @answer.country.present? %>
              <%=@answer.country.name%>
            <% end %>
          <% elsif question_type=="languages" %>
            <% if @answer.language.present? %>
              <%=@answer.language.name%>
            <% end %>
          <% end %>
        </td>
      <% end %>
      <td>
        <% if user.inform_platform !=nil  %>
          <%= user.inform_platform %>
        <% else %>
          no answer
        <% end %>
      </td>
      <td>
        <% if user.email? %>
          <%= user.email %>
        <% else %>
          Anonymous
        <% end %>
      </td>
      <td>
        <% if user.contact !=nil  %>
          <%= user.contact %>
        <% else %>
          false
        <% end %>
      </td>
    </tr>
  <% end %>

  <!-- <% @question_users.each do |user| %>
    <tr>
      <td style="text-align:left;"><%= user.created_at.to_date %></td>
      <td style="text-align:left;">
        <%= user.age %>
      </td>
      <td style="text-align:left;">
        <%= @platform.title %>
      </td>

      <% if user.question_user_submissions.present? %>
        <% user.question_user_submissions.each do |submission| %>
          <td style="text-align:left;">
            <% if submission.question_answer.present? && submission.question_answer.question.present? %>
              <% question_type=submission.question_answer.question.question_type %>
              <% if question_type=="text" || question_type=="long_text" || question_type=="url" || question_type=="email" %>
                <% unless submission.question_answer.answer_text.nil? %>
                  <%=submission.question_answer.answer_text%>
                <% else %>
                  no answer
                <% end %>
              <% elsif question_type=="upload" %>
                <%= file_download_link(submission) %>
              <% elsif question_type=="select" %>
                <% unless submission.question_answer.question_option.nil? ||
                  submission.page.nil? ||
                  submission.question_answer.question_option.nil? ||
                  submission.question_answer.nil? %>
                  <%=submission.question_answer.question_option.option_title.gsub('{platform}',submission.page.social_media_platform.title)%>
                <% else %>
                  no answer
                <% end %>
              <% elsif question_type=="multi_select" %>
                <% showMultiOptionsAnswers(submission.question_answer.question.id,submission.id) %>
                <% if @question_answers.count >0 %>
                  <% @question_answers.each do |option| %>
                    <ul>
                      <% if option.other_option_answer %>
                        <li><%=option.other_option_answer%></li>
                      <% else %>
                        <li><%=option.question_option.option_title.gsub('{platform}',submission.page.social_media_platform.title)%></li>
                      <% end %>
                    </ul>
                  <% end %>
                <% else %>
                  no answer
                <% end %>
              <% elsif question_type=="countries" %>
                <% if submission.question_answer.country.present? %>
                  <%=submission.question_answer.country.name%>
                <% end %>
              <% elsif question_type=="languages" %>
                <% if submission.question_answer.language.present? %>
                  <%=submission.question_answer.language.name%>
                <% end %>
              <% end %>
            <% else %>
              no answer
            <% end %>
          </td>
        <% end %>
      <% end %>

      <td style="text-align:left;">
        <% if user.inform_platform !=nil  %>
          <%= user.inform_platform %>
        <% else %>
          no answer
        <% end %>
      </td>
      <td style="text-align:left;">
        <% if user.email? %>
          <%= user.email %>
        <% else %>
          Anonymous
        <% end %>
      </td>
      <td style="text-align:left;">
        <% if user.contact !=nil  %>
          <%= user.contact %>
        <% else %>
          false
        <% end %>
      </td>
    </tr>
  <% end %> -->



</table>
